<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>53rd Street Scrollytelling – Prototype</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #000;
      color: #fff;
      overflow-x: hidden;
    }

    main {
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
    }

    section {
      position: relative;
      width: 100%;
    }

    /* ---------- HERO (TITLE) SECTION ---------- */

    .hero {
      min-height: 100vh;
      background: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px 16px 40px;
      gap: 16px;
    }

    .hero img {
      width: 100%;
      max-width: 900px;
      height: auto;
      display: block;
      object-fit: cover;
      border-radius: 4px;
    }

    .hero-inner {
      max-width: 700px;
      width: 100%;
      text-align: left;
    }

    .hero-title {
      margin: 0 0 8px;
      font-size: 2rem;
      line-height: 1.2;
    }

    .hero-subtitle {
      margin: 0;
      font-size: 0.95rem;
      line-height: 1.5;
      opacity: 0.95;
    }

    @media (max-width: 768px) {
      .hero-inner {
        padding: 20px 14px 32px;
      }

      .hero-title {
        font-size: 1.6rem;
      }

      .hero-subtitle {
        font-size: 0.9rem;
      }
    }

    /* Intro / context section before the first walk */
    .intro {
      min-height: 40vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px 16px;
      background: #000;
    }

    .intro-inner {
      max-width: 640px;
      text-align: left;
    }

    .intro-heading {
      margin: 0 0 8px;
      font-size: 1.1rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      opacity: 0.8;
    }

    .intro-text {
      margin: 0;
      font-size: 0.95rem;
      line-height: 1.5;
      opacity: 0.9;
    }

    /* Stop / chapter section between walk and scenes */
    .stop-section {
      min-height: 30vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px 16px;
      background: #000;
    }

    .stop-inner {
      max-width: 640px;
      text-align: left;
    }

    .stop-heading {
      margin: 0 0 8px;
      font-size: 1.05rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      opacity: 0.85;
    }

    .stop-text {
      margin: 0;
      font-size: 0.95rem;
      line-height: 1.5;
      opacity: 0.9;
    }

    /* ---------- TRANSITION (SCROLL-DRIVEN WALK) ---------- */

    .walk {
      height: 400vh; /* bigger = slower walk; tweak this */
      background: #000;
    }

    .walk-sticky {
      position: sticky;
      top: 0;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
    }

    .walk-image {
      width: 100%;
      height: auto;
      display: block;
      object-fit: cover;
    }

    /* ---------- SCENES SECTION (SCROLL-DRIVEN, STEP-BY-STEP) ---------- */

    .scenes {
      min-height: 200vh; /* enough for multiple steps */
      background: #000;
    }

    .scenes-sticky {
      position: sticky;
      top: 0;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
    }

    .scenes-image {
      width: 100%;
      height: auto;
      display: block;
      object-fit: cover;
    }

    .scene-steps {
      position: relative;
    }

    .scene-step {
      height: 100vh; /* each = one scroll "page" for the scene image */
    }

    .scenes-frame {
      max-width: 100%;
      padding: 16px 12px 24px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .scene-caption {
      text-align: left;
    }

    .scene-caption-top {
      font-size: 0.85rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      opacity: 0.8;
    }

    .scene-title {
      margin: 0;
      font-size: 0.9rem;
    }

    .scene-caption-bottom {
      font-size: 0.9rem;
      line-height: 1.4;
      max-width: 70ch;
      opacity: 0.9;
    }

    .scene-text {
      margin: 0;
    }

    /* For mobile adjustments */
    @media (max-width: 768px) {
      .scenes-frame {
        padding: 12px 10px 20px;
      }

      .scene-caption-bottom {
        font-size: 0.85rem;
      }
    }

    /* debugging helper:
    .scene-step:nth-child(odd) { outline: 1px solid red; }
    .scene-step:nth-child(even) { outline: 1px solid blue; }
    */
  </style>
</head>
<body>

  <main>

    <!-- HERO / TITLE SCREEN -->
    <section class="hero">
      <div class="hero-inner">
        <h1 class="hero-title">A Walk Down Memory Lane:</h1>
        <p class="hero-subtitle">
          53rd Street (sometimes fondly called Downtown Hyde Park) has been home to many of us, and I'm sure its memories will live on for far longer.
          Let us take a stroll in time to see how it has become the place we've all grown to love.
        </p>
      </div>
      <img src="img/s0_01.jpeg" alt="53rd Street sign" />
    </section>

    <!-- INTRO / CONTEXT BEFORE FIRST WALK -->
    <section class="intro">
      <div class="intro-inner">
        <h2 class="intro-heading">Let’s rewind.</h2>
        <p class="intro-text">
          Scroll down to jump to 2007, and walk west along 53rd.
        </p>
      </div>
    </section>

    <!-- TRANSITION 1: scroll-driven walk t1-01 ... t1-07 -->
    <section class="walk"
             data-walk
             data-prefix="t1-"
             data-frames="7"
             data-ext="jpeg">
      <div class="walk-sticky">
        <img class="walk-image" src="img/t1-01.jpeg" alt="" />
      </div>
    </section>

    <!-- FIRST STOP SECTION -->
    <section class="stop-section">
      <div class="stop-inner">
        <h2 class="stop-heading">First stop — 1520 E 53rd (Valois)</h2>
        <p class="stop-text">
          Valois has been a constant on this block longer than most of us have been in Hyde Park.
          It has been the go to spot for breakfast, gossip, and morning recovery for generations of students.
        </p>
      </div>
    </section>

    <!-- SCENES GROUP 1: s1-01, s1-02, etc. (scroll-driven steps) -->
    <section class="scenes" data-scenes>
      <div class="scenes-sticky">
        <div class="scenes-frame">
          <div class="scene-caption scene-caption-top">
            <h2 class="scene-title"></h2>
          </div>

          <img class="scenes-image" src="" alt="" />

          <div class="scene-caption scene-caption-bottom">
            <p class="scene-text"></p>
          </div>
        </div>
      </div>

      <div class="scene-steps">
        <!-- Each step now includes image + title + text data -->
        <div
          class="scene-step"
          data-src="img/s1-01.jpeg"
          data-title="1520 E 53rd – 2007"
          data-text="Valois with Hollywood Video and Bonne Sante as neighbors, before the chains and apartments arrive.">
        </div>

        <div
          class="scene-step"
          data-src="img/s1-02.jpeg"
          data-title="1520 E 53rd – 2013"
          data-text="By now, LA Fitness and the new apartments come in. The block modernizes...">
        </div>

        <div
          class="scene-step"
          data-src="img/s1-03.jpeg"
          data-title="1520 E 53rd – 2016"
          data-text="Chipotle appears, and this corner starts to look more familiar.">
        </div>

        <div
          class="scene-step"
          data-src="img/s1-04.jpeg"
          data-title="1520 E 53rd – 2025"
          data-text="Jump to the present and we have the newly opened Chic-Fil-A under construction. But one thing is of course constant.">
        </div>
      </div>
    </section>

  </main>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      /* ===============================
         TRANSITIONS: SCROLL-DRIVEN WALKS
         =============================== */

      const walkSections = document.querySelectorAll("[data-walk]");

      walkSections.forEach(section => {
        const prefix = section.dataset.prefix || "";
        const frameCount = parseInt(section.dataset.frames, 10) || 0;
        const ext = section.dataset.ext || "jpeg";
        const imgEl = section.querySelector(".walk-image");

        const sources = [];
        for (let i = 1; i <= frameCount; i++) {
          const indexStr = String(i).padStart(2, "0");
          const src = `img/${prefix}${indexStr}.${ext}`;
          sources.push(src);

          // Preload frames
          const img = new Image();
          img.src = src;
        }

        section._frameSources = sources;
        section._imgEl = imgEl;
      });

      function updateWalks() {
        const viewportHeight = window.innerHeight;
        const scrollY = window.scrollY;

        walkSections.forEach(section => {
          const sources = section._frameSources;
          const imgEl = section._imgEl;
          if (!sources || sources.length === 0 || !imgEl) return;

          const maxIndex = sources.length - 1;

          const sectionTop = section.offsetTop;
          const sectionHeight = section.offsetHeight;

          let frameIndex;

          if (scrollY <= sectionTop) {
            // Before section starts → first frame
            frameIndex = 0;
          } else if (scrollY >= sectionTop + sectionHeight - viewportHeight) {
            // After section ends → last frame
            frameIndex = maxIndex;
          } else {
            // Inside section → map scroll progress to frame index
            const usableScroll = sectionHeight - viewportHeight || 1;
            const progress = (scrollY - sectionTop) / usableScroll; // 0–1
            const clamped = Math.min(Math.max(progress, 0), 1);
            frameIndex = Math.round(clamped * maxIndex);
          }

          const nextSrc = sources[frameIndex];
          // Avoid redundant src assignments
          if (!imgEl.src.endsWith(nextSrc)) {
            imgEl.src = nextSrc;
          }
        });
      }

      window.addEventListener("scroll", () => {
        window.requestAnimationFrame(updateWalks);
      });
      window.addEventListener("resize", updateWalks);

      // Initial paint
      updateWalks();

      /* ===============================
         SCENES: STICKY IMAGE + STEPS
         =============================== */

      const scenesSections = document.querySelectorAll("[data-scenes]");

      // Initialize each scenes group
      scenesSections.forEach(section => {
        const imgEl = section.querySelector(".scenes-image");
        const titleEl = section.querySelector(".scene-title");
        const textEl = section.querySelector(".scene-text");
        const steps = Array.from(section.querySelectorAll(".scene-step"));

        if (!imgEl || !titleEl || !textEl || steps.length === 0) return;

        section._imgEl = imgEl;
        section._titleEl = titleEl;
        section._textEl = textEl;
        section._steps = steps;

        // Set initial image + text from first step
        const firstStep = steps[0];
        const firstSrc = firstStep.dataset.src;
        const firstTitle = firstStep.dataset.title || "";
        const firstText = firstStep.dataset.text || "";

        if (firstSrc) {
          imgEl.src = firstSrc;
        }
        titleEl.textContent = firstTitle;
        textEl.textContent = firstText;
      });

      const stepObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (!entry.isIntersecting) return;

          const step = entry.target;
          const section = step.closest("[data-scenes]");
          if (!section) return;

          const imgEl = section._imgEl;
          const titleEl = section._titleEl;
          const textEl = section._textEl;

          const src = step.dataset.src;
          const title = step.dataset.title || "";
          const text = step.dataset.text || "";

          if (imgEl && src && !imgEl.src.endsWith(src)) {
            imgEl.src = src;
          }
          if (titleEl) {
            titleEl.textContent = title;
          }
          if (textEl) {
            textEl.textContent = text;
          }
        });
      }, {
        threshold: 0.6
      });

      scenesSections.forEach(section => {
        const steps = section._steps || [];
        steps.forEach(step => stepObserver.observe(step));
      });
    });
  </script>

</body>
</html>